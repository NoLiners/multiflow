<%- layout('layout') -%>

<%# ─────────────────────────────────────────────────── %>
<%# Streaming Server Hub Widget                         %>
<%# ─────────────────────────────────────────────────── %>
<div class="mb-6">
  <div class="bg-gradient-to-br from-gray-800 via-gray-800 to-gray-900 rounded-xl shadow-xl border border-gray-700/50 overflow-hidden">
    <!-- Header -->
    <div class="flex items-center justify-between px-5 py-4 border-b border-gray-700/60">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center shadow">
          <i class="ti ti-server-bolt text-white text-lg"></i>
        </div>
        <div>
          <h2 class="text-sm font-bold text-white">Streaming Server Hub</h2>
          <p class="text-xs text-gray-400">RTMP · SRT · HLS · DASH</p>
        </div>
      </div>
      <div class="flex items-center gap-1.5">
        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-green-900/40 border border-green-700/40 text-xs text-green-400 font-medium">
          <span class="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse inline-block"></span>
          Server Online
        </span>
      </div>
    </div>

    <!-- Content -->
    <div class="p-5 grid grid-cols-1 lg:grid-cols-3 gap-4">

      <!-- RTMP Ingest -->
      <div class="bg-gray-900/60 rounded-lg p-4 border border-gray-700/40 space-y-3">
        <div class="flex items-center gap-2 mb-1">
          <i class="ti ti-broadcast text-red-400 text-base"></i>
          <span class="text-xs font-semibold text-gray-300 uppercase tracking-wide">RTMP Ingest</span>
        </div>
        <div>
          <label class="text-[10px] text-gray-500 uppercase tracking-widest mb-1 block">Server URL</label>
          <div class="flex items-center gap-2">
            <code class="flex-1 text-xs bg-gray-900 text-blue-300 px-3 py-2 rounded-lg border border-gray-700 font-mono truncate" id="rtmp-url-display">rtmp://<%= serverIp %>/live</code>
            <button onclick="copyToClipboard('rtmp://<%= serverIp %>/live', this)" title="Copy"
              class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-lg bg-gray-700 hover:bg-blue-600 text-gray-300 hover:text-white transition-colors">
              <i class="ti ti-copy text-sm"></i>
            </button>
          </div>
        </div>
        <div>
          <label class="text-[10px] text-gray-500 uppercase tracking-widest mb-1 block">Stream Key</label>
          <div class="flex items-center gap-2">
            <code class="flex-1 text-xs bg-gray-900 text-purple-300 px-3 py-2 rounded-lg border border-gray-700 font-mono truncate" id="stream-key-display"><%= streamKey %></code>
            <button onclick="copyToClipboard('<%= streamKey %>', this)" title="Copy"
              class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-lg bg-gray-700 hover:bg-purple-600 text-gray-300 hover:text-white transition-colors">
              <i class="ti ti-copy text-sm"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- SRT Ingest -->
      <div class="bg-gray-900/60 rounded-lg p-4 border border-gray-700/40 space-y-3">
        <div class="flex items-center gap-2 mb-1">
          <i class="ti ti-antenna text-yellow-400 text-base"></i>
          <span class="text-xs font-semibold text-gray-300 uppercase tracking-wide">SRT Ingest</span>
        </div>
        <div>
          <label class="text-[10px] text-gray-500 uppercase tracking-widest mb-1 block">SRT URL</label>
          <div class="flex items-center gap-2">
            <code class="flex-1 text-xs bg-gray-900 text-yellow-300 px-3 py-2 rounded-lg border border-gray-700 font-mono truncate">srt://<%= serverIp %>:6000</code>
            <button onclick="copyToClipboard('srt://<%= serverIp %>:6000', this)" title="Copy"
              class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-lg bg-gray-700 hover:bg-yellow-600 text-gray-300 hover:text-white transition-colors">
              <i class="ti ti-copy text-sm"></i>
            </button>
          </div>
        </div>
        <div class="bg-gray-800/50 rounded-lg p-3 border border-gray-700/30">
          <p class="text-xs text-gray-400">Stream via SRT and it will be auto-forwarded to the internal RTMP server.</p>
        </div>
        <div>
          <label class="text-[10px] text-gray-500 uppercase tracking-widest mb-1 block">Stream Key (SRT)</label>
          <div class="flex items-center gap-2">
            <code class="flex-1 text-xs bg-gray-900 text-yellow-300 px-3 py-2 rounded-lg border border-gray-700 font-mono truncate">srt (fixed key)</code>
          </div>
        </div>
      </div>

      <!-- Playback Links -->
      <div class="bg-gray-900/60 rounded-lg p-4 border border-gray-700/40 space-y-3">
        <div class="flex items-center gap-2 mb-1">
          <i class="ti ti-player-play text-green-400 text-base"></i>
          <span class="text-xs font-semibold text-gray-300 uppercase tracking-wide">Playback</span>
        </div>

        <!-- HLS -->
        <div>
          <label class="text-[10px] text-gray-500 uppercase tracking-widest mb-1 block">HLS Stream URL</label>
          <div class="flex items-center gap-2">
            <code class="flex-1 text-xs bg-gray-900 text-green-300 px-3 py-2 rounded-lg border border-gray-700 font-mono truncate">http://<%= serverIp %>:8000/live/<%= streamKey %>/index.m3u8</code>
            <button onclick="copyToClipboard('http://<%= serverIp %>:8000/live/<%= streamKey %>/index.m3u8', this)" title="Copy"
              class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-lg bg-gray-700 hover:bg-green-600 text-gray-300 hover:text-white transition-colors">
              <i class="ti ti-copy text-sm"></i>
            </button>
          </div>
        </div>

        <!-- DASH -->
        <div>
          <label class="text-[10px] text-gray-500 uppercase tracking-widest mb-1 block">DASH Stream URL</label>
          <div class="flex items-center gap-2">
            <code class="flex-1 text-xs bg-gray-900 text-orange-300 px-3 py-2 rounded-lg border border-gray-700 font-mono truncate">http://<%= serverIp %>:8000/live/<%= streamKey %>/index.mpd</code>
            <button onclick="copyToClipboard('http://<%= serverIp %>:8000/live/<%= streamKey %>/index.mpd', this)" title="Copy"
              class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-lg bg-gray-700 hover:bg-orange-600 text-gray-300 hover:text-white transition-colors">
              <i class="ti ti-copy text-sm"></i>
            </button>
          </div>
        </div>

        <!-- Player shortcuts -->
        <div class="flex gap-2 pt-1">
          <a href="/player?type=hls&key=<%= streamKey %>"
            class="flex-1 flex items-center justify-center gap-1.5 bg-green-700 hover:bg-green-600 text-white text-xs font-medium py-2 rounded-lg transition-colors">
            <i class="ti ti-player-play text-xs"></i>
            HLS Player
          </a>
          <a href="/player?type=dash&key=<%= streamKey %>"
            class="flex-1 flex items-center justify-center gap-1.5 bg-orange-700 hover:bg-orange-600 text-white text-xs font-medium py-2 rounded-lg transition-colors">
            <i class="ti ti-player-play text-xs"></i>
            DASH Player
          </a>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
function copyToClipboard(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    const icon = btn.querySelector('i');
    const orig = icon.className;
    icon.className = 'ti ti-check text-sm text-green-400';
    btn.classList.add('bg-green-700');
    setTimeout(() => {
      icon.className = orig;
      btn.classList.remove('bg-green-700');
    }, 1500);
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
  });
}
</script>
<%# ─────────────────────────────────────────────────── %>
<%# END Streaming Server Hub Widget                     %>
<%# ─────────────────────────────────────────────────── %>
